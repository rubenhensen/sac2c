/*****************************************************************************
 * cuda targets
 *
 * NOTE: NVCC provides the `-Xcudafe "--diag_suppress=<key>"' flag in order
 *       to selectively disable certain warnings. At the moment, warnings for
 *       set but unused variables and declared but not referenced variables
 *       are deactivated (see CFLAGS). A list of valid keys to use can be
 *       found in doc/cuda_warning_codes.txt.
 *
 * NOTE: CUDA targets assume CUDA version 6.0 >= is used...
 */

target default_cuda :: default_sbi:
//SBI              :=  "cuda"
BACKEND          :=  "Cuda"

CUDA_ARCH        :=  "@CUDA_ARCH@"

CEXT             :=  ".cu"
CC               :=  "@NVCC_PATH@"
CFLAGS           :=  "@CUDA_ARCH@ --maxrregcount 20 -Xcompiler -Wall "
                     "-Xcompiler -Wno-unused -Xcompiler -fno-builtin "
                     "-Xcudafe '--diag_suppress=set_but_not_used --diag_suppress=declared_but_not_referenced' "
                     "-I@CUDA_ROOT@/include "
LIBS             :=  " @CCDLLINK@ -lcudart -lcublas"

target cuda :: default_cuda:
EXTLIBPATH       +=  "@CUDA_ROOT@/lib64:"

target cuda32 :: default_cuda:
EXTLIBPATH       +=  "@CUDA_ROOT@/lib:"

/*
 * These targets expose the CUDA host memory allocators
 *   Default is 'system' from `default_sbi'
 */

target cuda_alloc_registered:
//SBI              +=  "-reg"
CUDA_ALLOC       :=  "cureg"

target cuda_alloc_allocated:
//SBI              +=  "-alloc"
CUDA_ALLOC       :=  "cualloc"

target cuda_alloc_managed:
//SBI              +=  "-man"
CUDA_ALLOC       :=  "cuman"

target cuda_reg :: cuda :: cuda_alloc_registered:
target cuda_alloc :: cuda :: cuda_alloc_allocated:
target cuda_man :: cuda :: cuda_alloc_managed:

/*
 * These targets are only relevent for the `Hybrid' backend
 */

target cudahybrid :: cuda:
BACKEND          :=  "CudaHybrid"
MT_MODE          :=  2

target cudahybrid32 :: cuda32:
BACKEND          :=  "CudaHybrid"
MT_MODE          :=  2
