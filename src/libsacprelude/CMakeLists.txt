INCLUDE ("${SAC2C_SOURCE_DIR}/cmake/runtime/sac2c-variables.cmake")

# create directory
SET (PRELUDE_DIR "${DLL_BUILD_DIR}/prelude")
FILE (MAKE_DIRECTORY "${PRELUDE_DIR}/${TARGET_ENV}/${SBI}")
FILE (MAKE_DIRECTORY "${PRELUDE_DIR}/tree/${TARGET_ENV}")
SET (LIBSAC_MOD "${PRELUDE_DIR}/${TARGET_ENV}/${SBI}/libsacprelude${BUILD_TYPE_POSTFIX}Mod${SHARED_LIB_EXT}")
SET (LIBSAC_TREE "${PRELUDE_DIR}/tree/${TARGET_ENV}/libsacprelude${BUILD_TYPE_POSTFIX}Tree${SHARED_LIB_EXT}")

SET (LIBSAC_SRC
     "${PROJECT_BINARY_DIR}/sacprelude${BUILD_TYPE_POSTFIX}.sac")

ADD_CUSTOM_COMMAND (
    OUTPUT "${LIBSAC_MOD}" "${LIBSAC_TREE}"
    COMMAND ${SAC2C} -v0 -linksetsize ${LINKSETSIZE} -noprelude -nosaclibs -o ${PRELUDE_DIR} ${LIBSAC_SRC}
    DEPENDS ${LIBSAC_SRC} ${LIB_SAC2C}
    COMMENT "Generating libsacprelude for target `${TARGET}'")
ADD_CUSTOM_TARGET (libsacprelude-${TARGET} ALL DEPENDS "${LIBSAC_MOD}" "${LIBSAC_TREE}")
