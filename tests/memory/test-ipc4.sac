//
// SAC_TEST|include common.mk
// SAC_TEST|SAC2C_FLAGS += -trace rm
// SAC_TEST|CALL_SAC2C := $(SAC2C) $(SAC2C_FLAGS) -noprelude -v0
//
// SAC_TEST|all: <file-name-we>
// SAC_TEST|<tab>@./$< 2>&1 | $(GREP_COMMAND_OUTPUT) " allocated" 13
// SAC_TEST|<tab>@./$< 2>&1 | $(GREP_COMMAND_OUTPUT) " deallocated" 13

/*
 * This example uses the same inner for 2 operator parts.
 * It differs from ipc3 in that the second reference happens implicitly
 * through a propagate operation part as a result of the print inside the WL.
 * An oversight in the occurance test of IPC here caused the issue 2288.
 *
 * Compile with -noprelude -mem:ipc to see
 */

noinline
int[.] foo( int[.] a)
{  return a; }

int main()
{
    res = with {
             ([0] <= [i] < [11]) {
                 inner = [i,i,i,i,i,i,i,i,i,i,i];
                 StdIO::print( inner);
             } : inner;
          } : genarray( [11], [1,2,3,4,5,6,7,8,9,10,11]);
    return _sel_VxA_([0,0], res);
}
